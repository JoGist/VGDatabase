!!!
%html{:lang => "en", class: "container"}
  %head
    %title Search result - VGDatabase
  %body.visible
    %aside.sidebar.normal
      %nav
        %ul.sidebar__nav
          %li
            %a.sidebar__nav__link_plain
              =image_tag ('logo-normal.png')
          %li
            %a.sidebar__nav__link{:href => homepage_guest_path, "data-method" => "get"}
              %i.mdi.mdi-home
              %span.sidebar__nav__text Homepage
          %li.active
            %a.sidebar__nav__link_plain{}
              %i.mdi.mdi-database-search
              %span.sidebar__nav__text Search
          %li
            %a.sidebar__nav__link{:href => signup_path, "data-method" => "get"}
              %i.mdi.mdi-logout-variant
              %span.sidebar__nav__text Sign up 
          %li
            %a.sidebar__nav__link{:href => contactUs_guest_path, "data-method" => "get"}
              %i.mdi.mdi-information
              %span.sidebar__nav__text Contact us
    %br/
    %h1 Search result
    %div.page-content
      /%h4.extraMarginLeft 2 results
      -if @result.length == 0
        %h4 No result found 
      -else
        - @result.each do |game|
          -if game.keys.include?('cover') && game.keys.include?('genres') && game.keys.include?('platforms')
            -api_endpoint = 'https://api-v3.igdb.com/covers'
            -request_headers = { headers: { 'user-key' => Rails.application.credentials.maps[:igdb] } }
            -api = Apicalypse.new(api_endpoint, request_headers)
            -@cover = api.fields(:url).where(:id => game.values[1]).request[0].values[1]
            -@split = @cover.split('thumb')[0]+'cover_big'+@cover.split('thumb')[1]

            -api_endpoint = 'https://api-v3.igdb.com/genres'
            -request_headers = { headers: { 'user-key' => Rails.application.credentials.maps[:igdb] } }
            -api = Apicalypse.new(api_endpoint, request_headers)
            -@genres = api.fields(:name).where(:id => game.values[2][0]).request[0].values[1]

            -api_endpoint = 'https://api-v3.igdb.com/platforms'
            -request_headers = { headers: { 'user-key' => Rails.application.credentials.maps[:igdb] } }
            -api = Apicalypse.new(api_endpoint, request_headers)
            -@platform = api.fields(:name).where(:id => game.values[4][0]).request[0].values[1]

            .card
              .content.cardPadding
                %p.description Title: #{game.values[3]}
                %p.description Genre: #{@genres}
                %p.description Platforms: #{@platform}
                -if Game.exists?(:serial => game.values[0])
                  %a.btn{:href => guest_show_path(Game.where(:serial => game.values[0])[0].id), "data-method" => "get"} View info 
                -else
                  %a.btn{:href => signup_path, "data-method" => "get"}
                    %span.sidebar__nav__text Sign up to add
              %img.cover{:alt => "Game image cover", :src => "#{@split}"}
